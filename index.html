
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reálná vs syrová porce</title>
  <meta name="theme-color" content="#0f766e">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
  <style>
    :root { --bg:#0b1020; --accent:#0f766e; --panel:#131933; --text:#e6eef8; --muted:#b7c2d0; --danger:#e74c3c; --ok:#22c55e; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; background:var(--bg); color:var(--text); display:grid; place-items:start center; padding:24px; }
    header { max-width:1024px; width:100%; }
    h1 { margin:0 0 8px; font-size:1.6rem; }
    .subtitle { color:var(--muted); margin-bottom:16px; }
    .grid { display:grid; grid-template-columns: repeat(12,1fr); gap:12px; max-width:1024px; width:100%; }
    .card { background:var(--panel); border:1px solid #1c2447; border-radius:12px; padding:16px; }
    .card h2 { margin:0 0 12px; font-size:1.1rem; }
    label { display:block; font-size:.9rem; color:var(--muted); margin-bottom:6px; }
    input[type=number] { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #243055; background:#0e142a; color:var(--text); }
    input[readonly] { opacity:.85; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .btnbar { display:flex; gap:8px; margin-top:12px; }
    button { padding:10px 14px; border:1px solid #23534f; border-radius:8px; background:var(--accent); color:#fff; cursor:pointer; }
    button.secondary { background:transparent; color:var(--text); border-color:#33446e; }
    table { width:100%; border-collapse:collapse; }
    th, td { border-bottom:1px solid #223057; padding:8px; text-align:left; }
    th { color:var(--muted); font-weight:600; }
    .note { font-size:.85rem; color:var(--muted); margin-top:8px; }
    .status { margin-top:8px; font-size:.95rem; }
    .status .warn { color:var(--danger); }
    .status .ok { color:var(--ok); }
    footer { margin-top:16px; color:var(--muted); font-size:.85rem; }
  </style>
</head>
<body>
  <header>
    <h1>Reálná vs syrová porce</h1>
    <div class="subtitle">PWA kalkulačka pro výpočet reálné porce z hmotnosti syrové porce a hotové směsi. Uživatelé: Kája, Máša, Fanda, Tóňa.</div>
  </header>

  <main class="grid">
    <section class="card" style="grid-column: span 6;">
      <h2>Vstupy</h2>
      <label for="F1">Syrová porce [g] (F1)</label>
      <input id="F1" type="number" min="0" step="0.01" placeholder="např. 250" />

      <label for="F2" style="margin-top:12px;">Hotová směs [g] (F2)</label>
      <input id="F2" type="number" min="0" step="0.01" placeholder="např. 1200" />

      <label for="F3" style="margin-top:12px;">Reálná porce [g] (F3, výpočet)</label>
      <input id="F3" type="number" readonly />

      <div class="btnbar">
        <button id="resetBtn" class="secondary" type="button">Vymazat vše</button>
        <button id="exportBtn" type="button">Export CSV</button>
      </div>
      <div class="note">F3 = F1 × F2 / (F9 + ... + F18). Pokud je součet surovin 0, výpočet se neprovede.</div>
      <div id="status" class="status"></div>
    </section>

    <section class="card" style="grid-column: span 6;">
      <h2>Suroviny (F9–F18)</h2>
      <div class="row">
        <div><label for="F9">1. (F9) [g]</label><input id="F9" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F10">2. (F10) [g]</label><input id="F10" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F11">3. (F11) [g]</label><input id="F11" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F12">4. (F12) [g]</label><input id="F12" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F13">5. (F13) [g]</label><input id="F13" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F14">6. (F14) [g]</label><input id="F14" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F15">7. (F15) [g]</label><input id="F15" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F16">8. (F16) [g]</label><input id="F16" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F17">9. (F17) [g]</label><input id="F17" type="number" min="0" step="0.01" value="0" /></div>
        <div><label for="F18">10. (F18) [g]</label><input id="F18" type="number" min="0" step="0.01" value="0" /></div>
      </div>
    </section>

    <section class="card" style="grid-column: span 12;">
      <h2>Porce / Poměr / Podíl</h2>
      <table>
        <thead><tr><th>Osoba</th><th>Porce [g]</th><th>Poměr</th><th>Podíl [%]</th></tr></thead>
        <tbody>
          <tr>
            <td>Kája</td>
            <td><input id="F5" type="number" readonly /></td>
            <td><input id="F6" type="number" readonly /></td>
            <td><input id="F7" type="number" min="0" step="0.01" placeholder="např. 20" /></td>
          </tr>
          <tr>
            <td>Máša (referenční)</td>
            <td><input id="G5" type="number" readonly /></td>
            <td><input id="G6" type="number" readonly /></td>
            <td><input id="G7" type="number" min="0" step="0.01" placeholder="např. 25" /></td>
          </tr>
          <tr>
            <td>Fanda</td>
            <td><input id="H5" type="number" readonly /></td>
            <td><input id="H6" type="number" readonly /></td>
            <td><input id="H7" type="number" min="0" step="0.01" placeholder="např. 30" /></td>
          </tr>
          <tr>
            <td>Tóňa</td>
            <td><input id="I5" type="number" readonly /></td>
            <td><input id="I6" type="number" readonly /></td>
            <td><input id="I7" type="number" min="0" step="0.01" placeholder="např. 25" /></td>
          </tr>
        </tbody>
      </table>
      <div class="note">F6 = F7/100, G6 = G7/100, H6 = H7/100, I6 = I7/100. Porce: F5 = F3 × F7 / G7; G5 = F3; H5 = F3 × H7 / G7; I5 = F3 × I7 / G7.</div>
      <div id="summary" class="status"></div>
    </section>
  </main>

  <footer>
    Instalovatelná PWA • Offline podpora přes Service Worker • Nastavení se ukládají do localStorage.
  </footer>

  <script>
    const KEYS_MANUAL = ['F1','F2','F9','F10','F11','F12','F13','F14','F15','F16','F17','F18','F7','G7','H7','I7'];

    function readNumber(id){ const el=document.getElementById(id); const v=parseFloat(el.value); return isFinite(v)?v:0; }
    function writeNumber(id,v){ const el=document.getElementById(id); el.value=(isFinite(v)?v:0).toFixed(2); }
    function sumIngredients(){ return ['F9','F10','F11','F12','F13','F14','F15','F16','F17','F18'].reduce((s,id)=>s+readNumber(id),0); }

    function recompute(){
      const F1=readNumber('F1');
      const F2=readNumber('F2');
      const Fsum=sumIngredients();
      let F3=0; if(Fsum>0) F3=F1*F2/Fsum; writeNumber('F3',F3);

      const F7=readNumber('F7'), G7=readNumber('G7'), H7=readNumber('H7'), I7=readNumber('I7');
      writeNumber('F6',F7/100); writeNumber('G6',G7/100); writeNumber('H6',H7/100); writeNumber('I6',I7/100);

      const denom=G7; const status=document.getElementById('status'); const summary=document.getElementById('summary');
      if(Fsum===0) status.innerHTML='<span class="warn">Součet surovin je 0 – zadejte F9..F18.</span>'; else if(denom===0) status.innerHTML='<span class="warn">Referenční podíl G7 je 0 – nastavte nenulovou hodnotu.</span>'; else status.innerHTML='<span class="ok">Výpočet v pořádku.</span>';

      const F5=denom?F3*F7/denom:0, G5=denom?F3*G7/denom:0, H5=denom?F3*H7/denom:0, I5=denom?F3*I7/denom:0;
      writeNumber('F5',F5); writeNumber('G5',G5); writeNumber('H5',H5); writeNumber('I5',I5);

      const sumShares=F7+G7+H7+I7; const sumPortions=F5+G5+H5+I5; const diff=sumPortions-F3;
      summary.innerHTML=`Součet podílů: ${sumShares.toFixed(2)} % • Součet porcí: ${sumPortions.toFixed(2)} g • Reálná porce (F3): ${F3.toFixed(2)} g • Rozdíl (Σ porce − F3): ${diff.toFixed(2)} g`;
    }

    function saveAll(){ const data={}; for(const id of KEYS_MANUAL) data[id]=document.getElementById(id).value; localStorage.setItem('real-vs-syrova',JSON.stringify(data)); }
    function loadAll(){ try{ const data=JSON.parse(localStorage.getItem('real-vs-syrova'))||{}; for(const id of KEYS_MANUAL) if(id in data) document.getElementById(id).value=data[id]; }catch(e){} }

    function exportCSV(){
      const header=['F1','F2','F3','F9','F10','F11','F12','F13','F14','F15','F16','F17','F18','F5','G5','H5','I5','F6','G6','H6','I6','F7','G7','H7','I7'];
      const ids=['F1','F2','F3','F9','F10','F11','F12','F13','F14','F15','F16','F17','F18','F5','G5','H5','I5','F6','G6','H6','I6','F7','G7','H7','I7'];
      const row=ids.map(id=>{ const el=document.getElementById(id); return el?el.value:'';});
      const csv=[header.join(','), row.join(',')].join('
');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='real-vs-syrova.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      loadAll();
      for(const id of KEYS_MANUAL){ document.getElementById(id).addEventListener('input',()=>{ saveAll(); recompute(); }); }
      document.getElementById('exportBtn').addEventListener('click', exportCSV);
      document.getElementById('resetBtn').addEventListener('click',()=>{ for(const id of KEYS_MANUAL) document.getElementById(id).value=''; saveAll(); recompute(); });
      recompute();
    });

    if('serviceWorker' in navigator){ window.addEventListener('load',()=>{ navigator.serviceWorker.register('./sw.js'); }); }
  </script>
</body>
</html>
